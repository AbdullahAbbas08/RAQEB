<app-breadcrumb [title]="'LGD Calculator'" [items]="['Dashboard']" [active_item]="'LGD Upload'"></app-breadcrumb>
<div class="lgd-upload-container">
    <div class="upload-card">
        <div class="upload-header">
            <div class="logo-section">
                <p>{{HeaderTitle}}</p>
            </div>
        </div>
        <div class="upload-content">
            <div class="steps-section">
                <div class="step" [class.active]="!isFilesSelected()">
                    <div class="step-number">1</div>
                    <div class="step-text">Select File{{Type === 'PD' ? 's' : ''}}</div>
                </div>
                <div class="step-connector"></div>
                <div class="step" [class.active]="isFilesSelected() && !uploading">
                    <div class="step-number">2</div>
                    <div class="step-text">Review</div>
                </div>
                <div class="step-connector"></div>
                <div class="step" [class.active]="uploading">
                    <div class="step-number">3</div>
                    <div class="step-text">Calculate</div>
                </div>
            </div>

            <!-- PD Files Upload (Two Files) -->
            <ng-container *ngIf="Type === 'PD'">
                <div class="files-grid">
                    <!-- PD File -->
                    <div class="file-section">
                        <div class="file-section-label">
                            PD File
                            <span class="optional-badge">اختياري</span>
                        </div>
                        <div class="dropzone"
                             [class.active]="pdFile"
                             [class.disabled]="uploading">
                            <input type="file"
                                   class="file-input"
                                   id="pdFileInput"
                                   (change)="onPDFileSelected($event)"
                                   [disabled]="uploading"
                                   accept=".xlsx,.xlsm,.xls">

                            <div class="upload-placeholder" *ngIf="!pdFile">
                                <i class="fa fa-cloud-upload"></i>
                                <h3>Drop PD file here</h3>
                                <p>or</p>
                                <button class="browse-btn">Browse Files</button>
                                <div class="file-types">Supported: .xlsx, .xlsm, .xls</div>
                            </div>
                            <div class="file-selected" *ngIf="pdFile">
                                <div class="file-preview">
                                    <i class="fa fa-file-excel-o file-icon"></i>
                                    <div class="file-details">
                                        <h4>{{ pdFile.name }}</h4>
                                        <p>{{ (pdFile.size / 1024 / 1024).toFixed(2) }} MB</p>
                                    </div>
                                    <button class="remove-file"
                                            *ngIf="!uploading"
                                            (click)="removePDFile($event)">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Macro File -->
                    <div class="file-section">
                        <div class="file-section-label">
                            Macro File
                            <span class="optional-badge">اختياري</span>
                        </div>
                        <div class="dropzone"
                             [class.active]="macroFile"
                             [class.disabled]="uploading">
                            <input type="file"
                                   class="file-input"
                                   id="macroFileInput"
                                   (change)="onMacroFileSelected($event)"
                                   [disabled]="uploading"
                                   accept=".xlsx,.xlsm,.xls">

                            <div class="upload-placeholder" *ngIf="!macroFile">
                                <i class="fa fa-cloud-upload"></i>
                                <h3>Drop Macro file here</h3>
                                <p>or</p>
                                <button class="browse-btn">Browse Files</button>
                                <div class="file-types">Supported: .xlsx, .xlsm, .xls</div>
                            </div>
                            <div class="file-selected" *ngIf="macroFile">
                                <div class="file-preview">
                                    <i class="fa fa-file-excel-o file-icon"></i>
                                    <div class="file-details">
                                        <h4>{{ macroFile.name }}</h4>
                                        <p>{{ (macroFile.size / 1024 / 1024).toFixed(2) }} MB</p>
                                    </div>
                                    <button class="remove-file"
                                            *ngIf="!uploading"
                                            (click)="removeMacroFile($event)">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>

            <!-- LGD File Upload (Single File) -->
            <ng-container *ngIf="Type === 'LGD'">
                <div class="dropzone"
                     [class.active]="selectedFile"
                     [class.disabled]="uploading">
                    <input type="file"
                           class="file-input"
                           id="fileInput"
                           (change)="onFileSelected($event)"
                           [disabled]="uploading"
                           accept=".xlsx,.xlsm,.xls">

                    <div class="upload-placeholder" *ngIf="!selectedFile">
                        <i class="fa fa-cloud-upload"></i>
                        <h3>Drop your Excel file here</h3>
                        <p>or</p>
                        <button class="browse-btn">Browse Files</button>
                        <div class="file-types">Supported formats: .xlsx, .xlsm, .xls</div>
                    </div>
                    <div class="file-selected" *ngIf="selectedFile">
                        <div class="file-preview">
                            <i class="fa fa-file-excel-o file-icon"></i>
                            <div class="file-details">
                                <h4>{{ selectedFile.name }}</h4>
                                <p>{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
                            </div>
                            <button class="remove-file"
                                    *ngIf="!uploading"
                                    (click)="selectedFile = null">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>
            <ng-container *ngIf="Type === 'ECL'">
                <div class="dropzone"
                     [class.active]="selectedFile"
                     [class.disabled]="uploading">
                    <input type="file"
                           class="file-input"
                           id="fileInput"
                           (change)="onFileSelected($event)"
                           [disabled]="uploading"
                           accept=".xlsx,.xlsm,.xls">

                    <div class="upload-placeholder" *ngIf="!selectedFile">
                        <i class="fa fa-cloud-upload"></i>
                        <h3>Drop your Excel file here</h3>
                        <p>or</p>
                        <button class="browse-btn">Browse Files</button>
                        <div class="file-types">Supported formats: .xlsx, .xlsm, .xls</div>
                    </div>
                    <div class="file-selected" *ngIf="selectedFile">
                        <div class="file-preview">
                            <i class="fa fa-file-excel-o file-icon"></i>
                            <div class="file-details">
                                <h4>{{ selectedFile.name }}</h4>
                                <p>{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
                            </div>
                            <button class="remove-file"
                                    *ngIf="!uploading"
                                    (click)="selectedFile = null">
                                <i class="fa fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </ng-container>

            <div class="action-section">
                <button class="calculate-btn"
                        [class.processing]="uploading"
                        (click)="uploadFile()"
                        [disabled]="!canUpload() || uploading">
                    <i class="fa" [ngClass]="uploading ? 'fa-spinner fa-spin' : 'fa-calculator'"></i>
                    <span>{{ uploading ? 'Processing...' : BtnTitle }}</span>
                </button>
            </div>
        </div>
    </div>
</div>